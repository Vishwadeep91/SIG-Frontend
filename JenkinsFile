pipeline {
  agent any
  environment {
    IMAGE_NAME = "vishwadeep91/front-end-react-app:${BUILD_NUMBER}"
  }
  stages {
    stage('Checkout') {
      steps {
        // sh 'echo passed'
        checkout scm
      }
    }
    stage('Build and Push Docker Image') {
      environment {
        IMAGE_NAME = "vishwadeep91/front-end-react-app:${BUILD_NUMBER}"
        REGISTRY_CREDENTIALS = credentials('docker-cred')
      }
      steps {
        script {    
          sh "docker build -t ${IMAGE_NAME} ."
          def dockerImage = docker.image("${IMAGE_NAME}")
          docker.withRegistry('https://index.docker.io/v1/', "docker-cred") {
            dockerImage.push()
          }
        }
      }
    }
    stage('Run Container') {
      steps {
        sh "docker run -d -p 8081:80 ${env.IMAGE_NAME}"
      }
    }
  }
}